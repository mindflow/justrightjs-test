import{Method as t,List as e,Map as s,Logger as n}from"./coreutil_v1.js";import{ComponentFactory as i,CanvasStyles as r,EventRegistry as o}from"./justright_core_v1.js";import{InjectionPoint as c,MindiConfig as h,InstancePostConfigTrigger as l,MindiInjector as a}from"./mindi_v1.js";import{TestClassState as u,TestTrigger as g,ObjectProvider as d,TestBench as m}from"./testbench_v1.js";class p{static get COMPONENT_NAME(){return"LineEntry"}static get TEMPLATE_URL(){return"/assets/justrightjs-test/lineEntry.html"}static get STYLES_URL(){return"/assets/justrightjs-test/lineEntry.css"}constructor(t,e=null){this.componentFactory=c.instance(i),this.line=t,this.color=e}postConfig(){this.component=this.componentFactory.create(p.COMPONENT_NAME),r.enableStyle(p.COMPONENT_NAME),this.component.setChild("lineEntry",this.line),this.color&&this.component.get("lineEntry").setAttributeValue("style","color:"+this.color)}}class E{static get COMPONENT_NAME(){return"TestEntryFunction"}static get TEMPLATE_URL(){return"/assets/justrightjs-test/testEntryFunction.html"}static get STYLES_URL(){return"/assets/justrightjs-test/testEntryFunction.css"}constructor(t,e,s){this.componentFactory=c.instance(i),this.eventRegistry=c.instance(o),this.testClass=t,this.testFunction=e,this.testTrigger=s}postConfig(){this.component=this.componentFactory.create(E.COMPONENT_NAME),r.enableStyle(E.COMPONENT_NAME),this.component.setChild("testEntryFunctionName",this.testFunction.name),this.eventRegistry.attach(this.component.get("runButton"),"onclick","//event:runClicked",this.component.componentIndex),this.eventRegistry.listen("//event:runClicked",new t(this,this.runClicked),this.component.componentIndex)}runClicked(){this.testTrigger.runFunction(this.testClass.name,this.testFunction.name)}result(t){u.RUNNING===t.state&&this.running(),u.SUCCESS===t.state&&this.succeed(),u.FAIL===t.state&&this.fail()}fail(){this.component.get("testEntryFunctionName").setAttributeValue("style","font-weight:bold;color:red")}succeed(){this.component.get("testEntryFunctionName").setAttributeValue("style","font-weight:bold;color:green")}running(){this.component.get("testEntryFunctionName").setAttributeValue("style","font-weight:bold;color:black")}reset(){this.component.get("testEntryFunctionName").removeAttribute("style")}}class y{static get COMPONENT_NAME(){return"TestEntry"}static get TEMPLATE_URL(){return"/assets/justrightjs-test/testEntry.html"}static get STYLES_URL(){return"/assets/justrightjs-test/testEntry.css"}constructor(t,s){this.componentFactory=c.instance(i),this.eventRegistry=c.instance(o),this.testEntryFunctionProvider=c.provider(E),this.testClass=t,this.testTrigger=s,this.testEntryFunctionList=new e,this.failed=!1}postConfig(){this.component=this.componentFactory.create(y.COMPONENT_NAME),r.enableStyle(y.COMPONENT_NAME),this.component.setChild("testEntryName",this.testClass.name),this.eventRegistry.attach(this.component.get("runButton"),"onclick","//event:runClicked",this.component.componentIndex),this.eventRegistry.listen("//event:runClicked",new t(this,this.runClicked),this.component.componentIndex);this.testClass.testFunctions().forEach(((t,e)=>(this.testEntryFunctionProvider.get([this.testClass,t,this.testTrigger]).then((t=>{this.testEntryFunctionList.add(t),this.component.get("testEntryFunctions").addChild(t.component)})),!0)),this)}runClicked(){this.failed=!1,this.testTrigger.runClass(this.testClass.name)}result(t){this.testEntryFunctionList.forEach(((e,s)=>(e.testFunction.name===t.functionName&&e.result(t),!0)),this),this.failed||u.RUNNING!==t.state||this.running(),this.failed||u.SUCCESS!==t.state||this.succeed(),u.FAIL===t.state&&this.fail()}fail(){this.failed=!0,this.component.get("testEntryName").setAttributeValue("style","font-weight:bold;color:red")}succeed(){this.component.get("testEntryName").setAttributeValue("style","font-weight:bold;color:green")}running(){this.component.get("testEntryName").setAttributeValue("style","font-weight:bold;color:black")}reset(){this.failed=!1,this.testEntryFunctionList.forEach(((t,e)=>(t.reset(),!0)),this),this.component.get("testEntryName").removeAttribute("style")}}class C{static get COMPONENT_NAME(){return"TestBenchView"}static get TEMPLATE_URL(){return"/assets/justrightjs-test/testBenchView.html"}static get STYLES_URL(){return"/assets/justrightjs-test/testBenchView.css"}constructor(t){this.componentFactory=c.instance(i),this.eventRegistry=c.instance(o),this.testTrigger=t,this.testEntryMap=new s}postConfig(){this.component=this.componentFactory.create(C.COMPONENT_NAME),r.enableStyle(C.COMPONENT_NAME),this.eventRegistry.attach(this.component.get("clearButton"),"onclick","//event:clearClicked",this.component.componentIndex),this.eventRegistry.listen("//event:clearClicked",new t(this,this.clearClicked),this.component.componentIndex),this.eventRegistry.attach(this.component.get("runAllButton"),"onclick","//event:runAllClicked",this.component.componentIndex),this.eventRegistry.listen("//event:runAllClicked",new t(this,this.runAllClicked),this.component.componentIndex),this.eventRegistry.attach(this.component.get("resetButton"),"onclick","//event:resetClicked",this.component.componentIndex),this.eventRegistry.listen("//event:resetClicked",new t(this,this.resetClicked),this.component.componentIndex)}addTestEntry(t){this.testEntryMap.set(t.testClass.name,t),this.component.addChild("testList",t.component)}runAllClicked(){this.testTrigger.runAll()}clearClicked(){this.component.clearChildren("testResult")}addLine(t){this.component.addChild("testResult",t.component)}resetClicked(){this.testEntryMap.forEach(((t,e,s)=>(e.reset(),!0)),this)}result(t){if(this.testEntryMap.contains(t.className)){this.testEntryMap.get(t.className).result(t)}}}class N extends g{constructor(){super()}set testBench(t){this.theTestBench=t}runFunction(t,e){this.theTestBench.runFunction(t,e)}runClass(t){this.theTestBench.runClass(t)}runAll(){this.theTestBench.runAll()}}class T extends d{constructor(){super()}async provide(t,e=[]){const s=new t(...e),n=new h;return n.addAllInstanceProcessor([l]),s.typeConfigList&&n.addAllTypeConfig(s.typeConfigList),await n.finalize(),await a.getInstance().injectTarget(s,n),s}}class A{constructor(){this.testTrigger=new N,this.componentFactory=c.instance(i),this.testBenchView=c.instance(C,[this.testTrigger]),this.testEntryProvider=c.provider(y),this.lineEntryProvider=c.provider(p),this.testBench=null,this.testEntryLoadedPromiseArray=[]}postConfig(){this.testBench=new m(new t(this,this.log),new t(this,this.result),new T),this.testTrigger.testBench=this.testBench}addTest(t){const e=this;if(!this.testBench.contains(t)){this.testBench.addTest(t);const s=this.testEntryProvider.get([t,this.testBench]).then((t=>{e.testBenchView.addTestEntry(t)}));this.testEntryLoadedPromiseArray.push(s)}return this}result(t){this.testBenchView.result(t)}async log(t,e){const s=this.asColor(e),n=await this.lineEntryProvider.get([t,s]);return this.testBenchView.addLine(n),n}asColor(t){return n.ERROR===t||n.FATAL===t?"red":null}get component(){return this.testBenchView.component}}export{T as DiObjectProvider,p as LineEntry,N as TestBenchTestTrigger,A as TestBenchUi,C as TestBenchView,y as TestEntry,E as TestEntryFunction};
